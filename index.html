<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EAå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* ç™»å½•ç•Œé¢æ ·å¼ */
        .login-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            width: 100%;
            max-width: 400px;
        }
        
        .login-header {
            background: #2c3e50;
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .login-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .login-header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .login-form {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: #f9f9f9;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }
        
        .login-btn {
            width: 100%;
            background: #3498db;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .login-alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
        }
        
        .alert-error {
            background: #fadbd8;
            color: #e74c3c;
            border: 1px solid #f5b7b1;
        }
        
        /* ä¸»ç³»ç»Ÿå®¹å™¨ */
        #mainContainer {
            display: none;
            max-width: 1400px;
            width: 100%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .logout-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 6px 15px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .header h1 {
            font-size: 26px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 15px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #eaeaea;
        }
        
        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-control {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: #f9f9f9;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }
        
        /* æœç´¢åŒºåŸŸæ ·å¼ */
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .search-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .search-title-icon {
            background: #3498db;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .search-box-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            flex: 1;
        }
        
        .search-label {
            font-size: 14px;
            color: #2c3e50;
            font-weight: 500;
            white-space: nowrap;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .search-input-container {
            flex: 1;
            min-width: 300px;
            position: relative;
            background: white;
            border-radius: 30px;
            border: 1px solid #ddd;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .search-input {
            width: 100%;
            padding: 12px 20px;
            padding-right: 50px;
            border: none;
            font-size: 14px;
            transition: all 0.3s;
            background: transparent;
        }
        
        .search-input:focus {
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #3498db;
            font-size: 18px;
            cursor: pointer;
        }
        
        .search-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .search-hint {
            margin-top: 8px;
            color: #6c757d;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .hint-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }
        
        .hint-icon {
            font-size: 12px;
            color: #3498db;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn-refresh {
            background: #2ecc71;
        }
        
        .btn-refresh:hover {
            background: #27ae60;
        }
        
        .btn-test {
            background: #9b59b6;
        }
        
        .btn-test:hover {
            background: #8e44ad;
        }
        
        .btn-clear {
            background: #95a5a6;
        }
        
        .btn-clear:hover {
            background: #7f8c8d;
        }
        
        .btn-export {
            background: #2ecc71;
        }
        
        .btn-export:hover {
            background: #27ae60;
        }
        
        .btn-template {
            background: #9b59b6;
        }
        
        .btn-template:hover {
            background: #8e44ad;
        }
        
        .btn-import {
            background: #f39c12;
        }
        
        .btn-import:hover {
            background: #d68910;
        }
        
        /* åˆ†é¡µæ ·å¼ */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .pagination-info {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .page-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #2c3e50;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            min-width: 36px;
            text-align: center;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
            font-weight: 600;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-ellipsis {
            padding: 6px 8px;
            color: #7f8c8d;
        }
        
        /* æ“ä½œæŒ‰é’®ç»„ */
        .actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            line-height: 1.2;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn-edit {
            background: #3498db;
            color: white;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .btn-delete:hover {
            background: #c0392b;
        }
        
        .btn-disable {
            background: #f39c12;
            color: white;
        }
        
        .btn-disable:hover {
            background: #d68910;
        }
        
        .btn-enable {
            background: #2ecc71;
            color: white;
        }
        
        .btn-enable:hover {
            background: #27ae60;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }
        
        th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            padding: 10px 8px;
            text-align: left;
            border-bottom: 2px solid #eaeaea;
            white-space: nowrap;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
            white-space: nowrap;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* åºå·åˆ—æ ·å¼ */
        .serial-number {
            width: 60px;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
        }
        
        /* å¤‡æ³¨åˆ—æ ·å¼ */
        .notes-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .notes-cell:hover {
            overflow: visible;
            white-space: normal;
            position: relative;
            z-index: 10;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .status-active {
            color: #27ae60;
            font-weight: 600;
            background: #d5f4e6;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
        }
        
        .status-inactive {
            color: #e74c3c;
            font-weight: 600;
            background: #fadbd8;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
        }
        
        .status-expired {
            color: #f39c12;
            font-weight: 600;
            background: #fef5e7;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin: 15px 0;
            display: none;
            font-size: 14px;
        }
        
        .alert-success {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #a3e4c1;
        }
        
        .alert-error {
            background: #fadbd8;
            color: #e74c3c;
            border: 1px solid #f5b7b1;
        }
        
        .alert-info {
            background: #d6eaf8;
            color: #2c3e50;
            border: 1px solid #aed6f1;
        }
        
        .alert-warning {
            background: #fef5e7;
            color: #f39c12;
            border: 1px solid #f8c471;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .modal-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-title span {
            font-size: 20px;
        }
        
        /* æ¨¡æ€æ¡†ä¸­çš„æŒ‰é’® */
        .modal-content .btn {
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .test-section {
            background: #f8f9fa;
            border: 1px dashed #ddd;
            padding: 20px;
            border-radius: 6px;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            display: none;
        }
        
        .delete-confirm {
            background: #fef5e7;
            border: 1px solid #f8c471;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .delete-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .delete-actions .btn {
            padding: 10px 20px;
        }
        
        /* æ–°å¢ï¼šå¿…å¡«å­—æ®µæç¤ºæ ·å¼ */
        .required-field::after {
            content: " *";
            color: #e74c3c;
        }
        
        .field-hint {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
            display: block;
        }
        
        /* å¯¼å‡ºå¯¼å…¥ç›¸å…³æ ·å¼ */
        .export-import-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .export-import-title {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-import-title span {
            font-size: 18px;
        }
        
        .file-input-container {
            margin-bottom: 15px;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .file-input-label:hover {
            background: #2980b9;
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .preview-container {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .preview-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #2c3e50;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .preview-table th {
            background: #e9ecef;
            padding: 8px;
            border: 1px solid #dee2e6;
            font-size: 12px;
        }
        
        .preview-table td {
            padding: 8px;
            border: 1px solid #dee2e6;
            font-size: 12px;
        }
        
        .preview-valid {
            color: #27ae60;
            font-weight: bold;
        }
        
        .preview-invalid {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .preview-exists {
            color: #f39c12;
        }
        
        .import-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .import-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .import-option:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }
        
        .import-option.active {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .import-option-icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .import-option-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .import-option-desc {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .import-mode {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .mode-options {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .mode-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mode-option input {
            margin: 0;
        }
        
        @media (max-width: 1200px) {
            table {
                font-size: 13px;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .section {
                padding: 20px;
            }
            
            .search-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input-container {
                min-width: 100%;
            }
            
            .search-title {
                margin-bottom: 10px;
            }
            
            .import-options {
                flex-direction: column;
            }
            
            .mode-options {
                flex-direction: column;
                gap: 10px;
            }
            
            table {
                font-size: 12px;
                display: block;
                overflow-x: auto;
            }
            
            th, td {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .serial-number {
                width: 40px;
            }
            
            .actions {
                flex-direction: column;
                gap: 4px;
            }
            
            .action-btn {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .btn {
                padding: 9px 16px;
                font-size: 13px;
            }
            
            .pagination-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .pagination-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginContainer" class="login-container">
        <div class="login-header">
            <h1>ğŸ” EAå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</h1>
            <p>è¯·ç™»å½•ä»¥ç®¡ç†å®¢æˆ·è´¦å·</p>
        </div>
        
        <div class="login-form">
            <div id="loginAlert" class="login-alert"></div>
            
            <div class="form-group">
                <label for="username" class="required-field">ç”¨æˆ·å</label>
                <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="islandshen@163.com">
            </div>
            
            <div class="form-group">
                <label for="password" class="required-field">å¯†ç </label>
                <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " value="Auo_0523">
            </div>
            
            <button onclick="login()" class="login-btn">ç™»å½•</button>
        </div>
    </div>
    
    <!-- ä¸»ç³»ç»Ÿç•Œé¢ -->
    <div id="mainContainer">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <button onclick="logout()" class="logout-btn">é€€å‡ºç™»å½•</button>
            <h1>ğŸ“‹ EAå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</h1>
            <p>ç®¡ç†å®¢æˆ·è´¦å·å’Œåˆ°æœŸæ—¶é—´</p>
        </div>
        
        <!-- ä¸»è¦å†…å®¹ -->
        <div class="content">
            <!-- æ·»åŠ å®¢æˆ·è¡¨å• -->
            <div class="section">
                <h2 class="section-title">â• æ·»åŠ æ–°å®¢æˆ·</h2>
                <div id="addAlert" class="alert"></div>
                
                <div class="form-row">
                    <input type="text" id="addAccountId" class="form-control" placeholder="è´¦å·ID (ä¾‹å¦‚: 888888)" required>
                    <input type="text" id="addServer" class="form-control" placeholder="æœåŠ¡å™¨ (ä¾‹å¦‚: ECMarkets-Live08)" required>
                    <input type="text" id="addIdentificationCode" class="form-control" placeholder="è¯†åˆ«ç  (å¿…å¡«)" required>
                </div>
                
                <div class="form-row">
                    <input type="date" id="addExpireDate" class="form-control" required>
                    <select id="addIsActive" class="form-control">
                        <option value="true">æ¿€æ´»çŠ¶æ€</option>
                        <option value="false">ç¦ç”¨çŠ¶æ€</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <textarea id="addNotes" class="form-control" placeholder="å¤‡æ³¨ä¿¡æ¯ (å¯é€‰)" rows="2" style="resize: vertical;"></textarea>
                </div>
                
                <button onclick="addNewClient()" class="btn">æ·»åŠ å®¢æˆ·</button>
            </div>
            
            <!-- å®¢æˆ·åˆ—è¡¨ -->
            <div class="section">
                <div class="section-title">
                    <span>ğŸ‘¥ å®¢æˆ·åˆ—è¡¨</span>
                </div>
                
                <!-- æœç´¢åŒºåŸŸ -->
                <div class="search-header">
                    <div class="search-title">
                        <div class="search-title-icon">ğŸ”</div>
                        <span>æœç´¢å®¢æˆ·ä¿¡æ¯</span>
                    </div>
                    
                    <div class="search-box-container">
                        <div class="search-label">å¿«é€ŸæŸ¥æ‰¾</div>
                        <div class="search-input-container">
                            <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥è´¦å·IDã€æœåŠ¡å™¨ã€è¯†åˆ«ç æˆ–å¤‡æ³¨...">
                            <span class="search-icon" onclick="searchClients()">ğŸ”</span>
                        </div>
                        <div class="search-actions">
                            <button onclick="clearSearch()" class="btn btn-clear">æ¸…é™¤æœç´¢</button>
                            <button onclick="loadClients()" class="btn btn-refresh">åˆ·æ–°åˆ—è¡¨</button>
                        </div>
                    </div>
                    
                    <div class="search-hint">
                        <div class="hint-item">
                            <span class="hint-icon">ğŸ“</span>
                            <span>æ”¯æŒæ¨¡ç³Šæœç´¢</span>
                        </div>
                        <div class="hint-item">
                            <span class="hint-icon">âš¡</span>
                            <span>è¾“å…¥2ä¸ªå­—ç¬¦ä»¥ä¸Šè‡ªåŠ¨æœç´¢</span>
                        </div>
                    </div>
                </div>
                
                <div id="listAlert" class="alert"></div>
                
                <div id="loading" class="loading">
                    <p>æ­£åœ¨åŠ è½½å®¢æˆ·æ•°æ®...</p>
                </div>
                
                <table id="clientsTable">
                    <thead>
                        <tr>
                            <th class="serial-number">åºå·</th>
                            <th>è´¦å·ID</th>
                            <th>æœåŠ¡å™¨</th>
                            <th>è¯†åˆ«ç </th>
                            <th>åˆ°æœŸæ—¶é—´</th>
                            <th>çŠ¶æ€</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>å¤‡æ³¨</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="clientsBody">
                        <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
                
                <!-- åˆ†é¡µæ§ä»¶ -->
                <div id="paginationContainer" class="pagination-container" style="display: none;">
                    <div class="pagination-info" id="paginationInfo"></div>
                    <div class="pagination-controls" id="paginationControls"></div>
                </div>
            </div>
            
            <!-- æ•°æ®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ -->
            <div class="section">
                <h2 class="section-title">ğŸ“Š æ•°æ®å¯¼å…¥å¯¼å‡º</h2>
                <div id="exportImportAlert" class="alert"></div>
                
                <!-- æ•°æ®å¯¼å‡ºåŠŸèƒ½ -->
                <div class="export-import-section">
                    <h3 class="export-import-title">
                        <span>ğŸ“¤</span>
                        æ•°æ®å¯¼å‡º
                    </h3>
                    
                    <div class="form-row" style="align-items: center;">
                        <div style="flex: 1;">
                            <p style="color: #2c3e50; font-size: 14px; margin-bottom: 10px;">
                                å¯¼å‡ºå½“å‰æœç´¢ç»“æœåˆ°CSVæ–‡ä»¶
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="exportData()" class="btn btn-export">
                                <span style="margin-right: 5px;">â¬‡ï¸</span>å¯¼å‡ºæ•°æ®
                            </button>
                            <button onclick="downloadTemplate('full')" class="btn btn-template">
                                ğŸ“‹ ä¸‹è½½å®Œæ•´æ¨¡æ¿
                            </button>
                            <button onclick="downloadTemplate('simple')" class="btn btn-template">
                                ğŸ“„ ä¸‹è½½ç®€åŒ–æ¨¡æ¿
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®å¯¼å…¥åŠŸèƒ½ -->
                <div class="export-import-section">
                    <h3 class="export-import-title">
                        <span>ğŸ“¥</span>
                        æ•°æ®å¯¼å…¥
                    </h3>
                    
                    <p style="color: #2c3e50; font-size: 14px; margin-bottom: 15px;">
                        æ”¯æŒå¯¼å…¥CSVæ ¼å¼çš„å®¢æˆ·æ•°æ®ï¼Œå¯æ‰¹é‡æ·»åŠ æˆ–æ›´æ–°å®¢æˆ·ä¿¡æ¯
                    </p>
                    
                    <!-- å¯¼å…¥é€‰é¡¹ -->
                    <div class="import-options" id="importOptions">
                        <div class="import-option active" onclick="selectImportOption('simple')">
                            <div class="import-option-icon">ğŸ“„</div>
                            <div class="import-option-title">ç®€åŒ–æ¨¡æ¿å¯¼å…¥</div>
                            <div class="import-option-desc">
                                é€‚åˆæ‰¹é‡æ·»åŠ æ–°å®¢æˆ·<br>
                                (6ä¸ªå¿…éœ€å­—æ®µ)
                            </div>
                        </div>
                        <div class="import-option" onclick="selectImportOption('full')">
                            <div class="import-option-icon">ğŸ“Š</div>
                            <div class="import-option-title">å®Œæ•´æ ¼å¼å¯¼å…¥</div>
                            <div class="import-option-desc">
                                å…¼å®¹å¯¼å‡ºçš„CSVæ–‡ä»¶<br>
                                (10ä¸ªå­—æ®µï¼Œé€‚åˆå¤‡ä»½æ¢å¤)
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ–‡ä»¶é€‰æ‹© -->
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 10px; color: #2c3e50; font-weight: 500;">
                            é€‰æ‹©CSVæ–‡ä»¶ <span style="font-weight: normal; color: #7f8c8d;" id="formatInfo">(æ”¯æŒç®€å•æ ¼å¼)</span>
                        </label>
                        <div class="file-input-container">
                            <label class="file-input-label">
                                ğŸ“ é€‰æ‹©æ–‡ä»¶
                                <input type="file" id="csvFile" class="file-input" accept=".csv" onchange="handleFileSelect()">
                            </label>
                            <span id="fileName" style="color: #7f8c8d; font-size: 14px;">æœªé€‰æ‹©æ–‡ä»¶</span>
                        </div>
                    </div>
                    
                    <!-- å¯¼å…¥æ¨¡å¼ -->
                    <div class="import-mode">
                        <label style="display: block; margin-bottom: 10px; color: #2c3e50; font-weight: 500;">å¯¼å…¥æ¨¡å¼</label>
                        <div class="mode-options">
                            <label class="mode-option">
                                <input type="radio" name="importMode" value="add" checked>
                                <span>ä»…æ·»åŠ æ–°è®°å½•ï¼ˆè·³è¿‡å·²å­˜åœ¨çš„è´¦å·ï¼‰</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="importMode" value="update">
                                <span>æ›´æ–°æ¨¡å¼ï¼ˆæ›´æ–°å·²å­˜åœ¨çš„è®°å½•ï¼‰</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- é¢„è§ˆåŒºåŸŸ -->
                    <div class="preview-container" id="previewContainer">
                        <div class="preview-stats">
                            <span>æ•°æ®é¢„è§ˆ (æœ€å¤šæ˜¾ç¤º10è¡Œ)</span>
                            <span id="previewStats">å…±0æ¡è®°å½•</span>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="preview-table" id="previewTable">
                                <thead id="previewHeader">
                                    <!-- è¡¨å¤´åŠ¨æ€ç”Ÿæˆ -->
                                </thead>
                                <tbody id="previewBody">
                                    <!-- æ•°æ®åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="previewImport()" class="btn" id="previewBtn" disabled>
                            ğŸ” é¢„è§ˆæ•°æ®
                        </button>
                        <button onclick="executeImport()" class="btn btn-import" id="importBtn" disabled>
                            ğŸ“¥ å¼€å§‹å¯¼å…¥
                        </button>
                        <button onclick="resetImport()" class="btn btn-clear">
                            ğŸ”„ é‡ç½®
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- æµ‹è¯•éªŒè¯ -->
            <div class="section test-section">
                <h2 class="section-title">ğŸ§ª æµ‹è¯•éªŒè¯æ¥å£</h2>
                <div id="testAlert" class="alert"></div>
                
                <div class="form-row">
                    <input type="text" id="testAccountId" class="form-control" placeholder="è¾“å…¥è´¦å·IDè¿›è¡Œæµ‹è¯•" value="1000132128">
                    <input type="text" id="testServer" class="form-control" placeholder="è¾“å…¥æœåŠ¡å™¨" value="FortunePrimeGlobal-Demo">
                </div>
                
                <button onclick="testVerify()" class="btn btn-test">æµ‹è¯•éªŒè¯</button>
                
                <div id="testResult" class="test-result"></div>
            </div>
        </div>
    </div>
    
    <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ç¼–è¾‘å®¢æˆ·ä¿¡æ¯</div>
            <div id="editAlert" class="alert"></div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 500;">è´¦å·ID:</label>
                <input type="text" id="editAccountId" class="form-control" readonly style="background: #f5f5f5;">
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 500;">æœåŠ¡å™¨:</label>
                <input type="text" id="editServer" class="form-control">
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 500;">è¯†åˆ«ç :</label>
                                <input type="text" id="editIdentificationCode" class="form-control">
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 500;">åˆ°æœŸæ—¶é—´:</label>
                <input type="date" id="editExpireDate" class="form-control">
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 500;">çŠ¶æ€:</label>
                <select id="editIsActive" class="form-control">
                    <option value="true">æ¿€æ´»</option>
                    <option value="false">ç¦ç”¨</option>
                </select>
            </div>
            
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 500;">å¤‡æ³¨:</label>
                <textarea id="editNotes" class="form-control" rows="3" style="resize: vertical;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button onclick="saveEdit()" class="btn">ä¿å­˜ä¿®æ”¹</button>
                <button onclick="closeEditModal()" class="btn" style="background: #95a5a6;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">âš ï¸ ç¡®è®¤åˆ é™¤</div>
            
            <div class="delete-confirm">
                <p style="color: #e74c3c; font-weight: 600; margin-bottom: 10px;">æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®¢æˆ·å—ï¼Ÿ</p>
                <p style="color: #7f8c8d; font-size: 14px;">è´¦å·ID: <span id="deleteAccountId" style="font-weight: 600;"></span></p>
                <p style="color: #7f8c8d; font-size: 14px;">æœåŠ¡å™¨: <span id="deleteServer" style="font-weight: 600;"></span></p>
                <p style="color: #7f8c8d; font-size: 14px;">è¯†åˆ«ç : <span id="deleteIdentificationCode" style="font-weight: 600;"></span></p>
                <p style="color: #e74c3c; font-size: 13px; margin-top: 15px; border-top: 1px dashed #f8c471; padding-top: 10px;">
                    âš ï¸ æ³¨æ„ï¼šæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œåˆ é™¤åå°†æ— æ³•æ¢å¤ï¼
                </p>
            </div>
            
            <div id="deleteAlert" class="alert"></div>
            
            <div class="delete-actions">
                <button onclick="confirmDelete()" class="btn btn-delete">ç¡®è®¤åˆ é™¤</button>
                <button onclick="closeDeleteModal()" class="btn" style="background: #95a5a6;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- å¯¼å…¥è¿›åº¦æ¨¡æ€æ¡† -->
    <div id="importProgressModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-title">ğŸ“¥ æ•°æ®å¯¼å…¥ä¸­...</div>
            
            <div id="importProgressAlert" class="alert"></div>
            
            <div id="importProgress" style="margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span id="importProgressText">æ­£åœ¨å¤„ç†...</span>
                    <span id="importProgressPercent">0%</span>
                </div>
                <div style="width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden;">
                    <div id="importProgressBar" style="width: 0%; height: 100%; background: #3498db; transition: width 0.3s;"></div>
                </div>
            </div>
            
            <div id="importResult" style="display: none;">
                <div style="background: #f8f9fa; border-radius: 6px; padding: 15px; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #2ecc71; font-weight: bold;">âœ… æˆåŠŸå¯¼å…¥: <span id="importSuccessCount">0</span></span>
                        <span style="color: #f39c12;">ğŸ”„ è·³è¿‡: <span id="importSkipCount">0</span></span>
                        <span style="color: #e74c3c;">âŒ å¤±è´¥: <span id="importFailCount">0</span></span>
                    </div>
                    <div id="importDetails" style="font-size: 13px; color: #7f8c8d; max-height: 200px; overflow-y: auto; padding: 10px; background: white; border-radius: 4px; border: 1px solid #dee2e6;">
                        <!-- å¯¼å…¥è¯¦æƒ…ä¼šåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="closeImportProgressModal()" class="btn" id="importCloseBtn" style="display: none;">
                    å®Œæˆ
                </button>
                <button onclick="cancelImport()" class="btn btn-clear" id="importCancelBtn">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ========== é…ç½® ==========
        const API_BASE = 'https://islandshen.pythonanywhere.com/api';
        let currentEditClient = null;
        let clientToDelete = null;
        let currentSearchQuery = '';
        let currentPage = 1;
        const perPage = 20;
        
        // ========== å¯¼å…¥ç›¸å…³å˜é‡ ==========
        let selectedFile = null;
        let importFormat = 'simple'; // 'simple' æˆ– 'full'
        let importPreviewData = [];
        let isImporting = false;
        let importCanceled = false;
        
        // ========== ç™»å½•åŠŸèƒ½ ==========
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showLoginAlert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainContainer').style.display = 'block';
                    
                    // è®¾ç½®é»˜è®¤åˆ°æœŸæ—¶é—´ï¼ˆ30å¤©åï¼‰
                    const defaultDate = new Date();
                    defaultDate.setDate(defaultDate.getDate() + 30);
                    document.getElementById('addExpireDate').valueAsDate = defaultDate;
                    
                    loadClients();
                } else {
                    showLoginAlert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
                }
                
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                showLoginAlert('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        function showLoginAlert(message) {
            const alertDiv = document.getElementById('loginAlert');
            alertDiv.textContent = message;
            alertDiv.className = 'login-alert alert-error';
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 3000);
        }
        
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('loginContainer').style.display = 'block';
                document.getElementById('username').value = 'islandshen@163.com';
                document.getElementById('password').value = 'Auo_0523';
            }
        }
        
        // ========== æ˜¾ç¤ºæç¤ºä¿¡æ¯ ==========
        function showAlert(elementId, message, type = 'error') {
            const alertDiv = document.getElementById(elementId);
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 3000);
        }
        
        function showMainAlert(message, type = 'error') {
            showAlert('exportImportAlert', message, type);
        }
        
        // ========== æœç´¢åŠŸèƒ½ ==========
        function searchClients() {
            const searchInput = document.getElementById('searchInput');
            currentSearchQuery = searchInput.value.trim();
            currentPage = 1;
            loadClients();
        }
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            currentSearchQuery = '';
            currentPage = 1;
            loadClients();
        }
        
        // ========== åˆ†é¡µåŠŸèƒ½ ==========
        function goToPage(page) {
            currentPage = page;
            loadClients();
        }
        
        function createPagination(pagination) {
            const container = document.getElementById('paginationContainer');
            const infoDiv = document.getElementById('paginationInfo');
            const controlsDiv = document.getElementById('paginationControls');
            
            if (pagination.pages <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            const start = (pagination.page - 1) * pagination.per_page + 1;
            const end = Math.min(pagination.page * pagination.per_page, pagination.total);
            infoDiv.textContent = `æ˜¾ç¤ºç¬¬ ${start} åˆ° ${end} æ¡ï¼Œå…± ${pagination.total} æ¡è®°å½•`;
            
            // åˆ›å»ºåˆ†é¡µæŒ‰é’®
            controlsDiv.innerHTML = '';
            
            // ä¸Šä¸€é¡µæŒ‰é’®
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.textContent = 'â€¹';
            prevBtn.disabled = !pagination.has_prev;
            prevBtn.onclick = () => goToPage(pagination.page - 1);
            controlsDiv.appendChild(prevBtn);
            
            // é¡µç æŒ‰é’®
            const maxVisiblePages = 5;
            let startPage = Math.max(1, pagination.page - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(pagination.pages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // ç¬¬ä¸€é¡µ
            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'page-btn';
                firstBtn.textContent = '1';
                firstBtn.onclick = () => goToPage(1);
                controlsDiv.appendChild(firstBtn);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'page-ellipsis';
                    ellipsis.textContent = '...';
                    controlsDiv.appendChild(ellipsis);
                }
            }
            
            // ä¸­é—´é¡µç 
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-btn';
                pageBtn.textContent = i;
                if (i === pagination.page) {
                    pageBtn.classList.add('active');
                }
                pageBtn.onclick = () => goToPage(i);
                controlsDiv.appendChild(pageBtn);
            }
            
            // æœ€åä¸€é¡µ
            if (endPage < pagination.pages) {
                if (endPage < pagination.pages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'page-ellipsis';
                    ellipsis.textContent = '...';
                    controlsDiv.appendChild(ellipsis);
                }
                
                const lastBtn = document.createElement('button');
                lastBtn.className = 'page-btn';
                lastBtn.textContent = pagination.pages;
                lastBtn.onclick = () => goToPage(pagination.pages);
                controlsDiv.appendChild(lastBtn);
            }
            
            // ä¸‹ä¸€é¡µæŒ‰é’®
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.textContent = 'â€º';
            nextBtn.disabled = !pagination.has_next;
            nextBtn.onclick = () => goToPage(pagination.page + 1);
            controlsDiv.appendChild(nextBtn);
        }
        
        // ========== åŠ è½½å®¢æˆ·åˆ—è¡¨ ==========
        async function loadClients() {
            const loadingDiv = document.getElementById('loading');
            const tbody = document.getElementById('clientsBody');
            
            loadingDiv.style.display = 'block';
            tbody.innerHTML = '';
            
            try {
                let url = `${API_BASE}/clients?page=${currentPage}&per_page=${perPage}`;
                if (currentSearchQuery) {
                    url += `&search=${encodeURIComponent(currentSearchQuery)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                const clients = data.clients || [];
                const pagination = data.pagination || { page: 1, per_page: perPage, total: 0, pages: 1 };
                
                if (clients.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #95a5a6;">
                                ğŸ“­ ${currentSearchQuery ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å®¢æˆ·' : 'æš‚æ— å®¢æˆ·æ•°æ®ï¼Œè¯·å…ˆæ·»åŠ å®¢æˆ·'}
                            </td>
                        </tr>
                    `;
                    document.getElementById('paginationContainer').style.display = 'none';
                } else {
                    clients.forEach((client, index) => {
                        const row = createClientRow(client, (pagination.page - 1) * pagination.per_page + index + 1);
                        tbody.appendChild(row);
                    });
                    
                    createPagination(pagination);
                }
                
                const searchInfo = currentSearchQuery ? `ï¼ˆæœç´¢: "${currentSearchQuery}"ï¼‰` : '';
                showAlert('listAlert', `å·²åŠ è½½ ${clients.length} ä¸ªå®¢æˆ·${searchInfo}`, 'success');
                
            } catch (error) {
                console.error('åŠ è½½å®¢æˆ·å¤±è´¥:', error);
                showAlert('listAlert', `åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #e74c3c;">
                            âŒ æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥
                        </td>
                    </tr>
                `;
                document.getElementById('paginationContainer').style.display = 'none';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }
        
        // ========== åˆ›å»ºå®¢æˆ·è¡Œ ==========
        function createClientRow(client, serialNumber) {
            const tr = document.createElement('tr');
            
            const expireDate = new Date(client.expire_date);
            const now = new Date();
            const isExpired = expireDate < now;
            const isActive = client.is_active;
            
            let statusText, statusClass;
            if (!isActive) {
                statusText = 'å·²ç¦ç”¨';
                statusClass = 'status-inactive';
            } else if (isExpired) {
                statusText = 'å·²è¿‡æœŸ';
                statusClass = 'status-expired';
            } else {
                statusText = 'æ­£å¸¸';
                statusClass = 'status-active';
            }
            
            let createdTime = 'æœªçŸ¥';
            if (client.created_at) {
                try {
                    const createdDate = new Date(client.created_at);
                    createdTime = createdDate.toLocaleDateString('zh-CN');
                } catch (e) {
                    createdTime = client.created_at;
                }
            }
            
            const identificationCode = client.identification_code || '-';
            const notes = client.notes || '-';
            
            tr.innerHTML = `
                <td class="serial-number">${serialNumber}</td>
                <td><strong>${client.account_id}</strong></td>
                <td>${client.license_key || client.server || 'æœªè®¾ç½®'}</td>
                <td>${identificationCode}</td>
                <td>${client.expire_date}</td>
                <td><span class="${statusClass}">${statusText}</span></td>
                <td>${createdTime}</td>
                <td class="notes-cell" title="${notes}">${notes}</td>
                <td>
                    <div class="actions">
                        <button onclick="openEditModal('${client.account_id}')" class="action-btn btn-edit">ç¼–è¾‘</button>
                        <button onclick="toggleClientStatus('${client.account_id}', ${!client.is_active})" class="action-btn ${client.is_active ? 'btn-disable' : 'btn-enable'}">
                            ${client.is_active ? 'ç¦ç”¨' : 'å¯ç”¨'}
                        </button>
                        <button onclick="openDeleteModal('${client.account_id}', '${client.license_key || client.server}', '${identificationCode}')" class="action-btn btn-delete">åˆ é™¤</button>
                    </div>
                </td>
            `;
            
            if (!isActive || isExpired) {
                tr.style.opacity = '0.7';
            }
            
            return tr;
        }
        
        // ========== æ·»åŠ æ–°å®¢æˆ· ==========
        async function addNewClient() {
            const accountId = document.getElementById('addAccountId').value.trim();
            const server = document.getElementById('addServer').value.trim();
            const identificationCode = document.getElementById('addIdentificationCode').value.trim();
            const expireDate = document.getElementById('addExpireDate').value;
            const isActive = document.getElementById('addIsActive').value === 'true';
            const notes = document.getElementById('addNotes').value.trim();
            
            if (!accountId || !server || !expireDate || !identificationCode) {
                showAlert('addAlert', 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆè´¦å·IDã€æœåŠ¡å™¨ã€è¯†åˆ«ç ã€åˆ°æœŸæ—¶é—´ï¼‰', 'error');
                return;
            }
            
            if (!/^\d+$/.test(accountId)) {
                showAlert('addAlert', 'è´¦å·IDå¿…é¡»æ˜¯æ•°å­—', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        account_id: accountId,
                        license_key: server,
                        identification_code: identificationCode,
                        expire_date: expireDate,
                        max_sessions: 999,
                        is_active: isActive,
                        notes: notes
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('addAlert', 'âœ… å®¢æˆ·æ·»åŠ æˆåŠŸï¼', 'success');
                    
                    document.getElementById('addAccountId').value = '';
                    document.getElementById('addServer').value = '';
                    document.getElementById('addIdentificationCode').value = '';
                    document.getElementById('addNotes').value = '';
                    
                    loadClients();
                } else {
                    showAlert('addAlert', `æ·»åŠ å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showAlert('addAlert', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // ========== æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡† ==========
        async function openEditModal(accountId) {
            try {
                const response = await fetch(`${API_BASE}/client/${accountId}`);
                const result = await response.json();
                
                if (result.success) {
                    const client = result.client;
                    currentEditClient = client;
                    
                    document.getElementById('editAccountId').value = client.account_id;
                    document.getElementById('editServer').value = client.license_key;
                    document.getElementById('editIdentificationCode').value = client.identification_code || '';
                    document.getElementById('editExpireDate').value = client.expire_date;
                    document.getElementById('editIsActive').value = client.is_active.toString();
                    document.getElementById('editNotes').value = client.notes || '';
                    
                    document.getElementById('editModal').style.display = 'flex';
                    
                } else {
                    showAlert('editAlert', 'å®¢æˆ·ä¸å­˜åœ¨', 'error');
                }
                
            } catch (error) {
                showAlert('editAlert', `åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // ========== å…³é—­ç¼–è¾‘æ¨¡æ€æ¡† ==========
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditClient = null;
        }
        
        // ========== ä¿å­˜ç¼–è¾‘ ==========
        async function saveEdit() {
            if (!currentEditClient) return;
            
            const server = document.getElementById('editServer').value.trim();
            const identificationCode = document.getElementById('editIdentificationCode').value.trim();
            const expireDate = document.getElementById('editExpireDate').value;
            const isActive = document.getElementById('editIsActive').value === 'true';
            const notes = document.getElementById('editNotes').value.trim();
            
            if (!server || !identificationCode || !expireDate) {
                showAlert('editAlert', 'æœåŠ¡å™¨ã€è¯†åˆ«ç å’Œåˆ°æœŸæ—¶é—´éƒ½æ˜¯å¿…å¡«é¡¹', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/update/${currentEditClient.account_id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        license_key: server,
                        identification_code: identificationCode,
                        expire_date: expireDate,
                        is_active: isActive,
                        notes: notes,
                        max_sessions: 999
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('editAlert', 'âœ… ä¿®æ”¹ä¿å­˜æˆåŠŸï¼', 'success');
                    setTimeout(() => {
                        closeEditModal();
                        loadClients();
                    }, 1000);
                } else {
                    showAlert('editAlert', `ä¿å­˜å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showAlert('editAlert', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // ========== åˆ‡æ¢å®¢æˆ·çŠ¶æ€ ==========
        async function toggleClientStatus(accountId, newStatus) {
            if (!confirm(`ç¡®å®šè¦${newStatus ? 'å¯ç”¨' : 'ç¦ç”¨'}è¿™ä¸ªè´¦å·å—ï¼Ÿ`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/update/${accountId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        is_active: newStatus
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('listAlert', `è´¦å·å·²${newStatus ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                    loadClients();
                } else {
                    showAlert('listAlert', `æ“ä½œå¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showAlert('listAlert', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // ========== æ‰“å¼€åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† ==========
        function openDeleteModal(accountId, server, identificationCode) {
            clientToDelete = accountId;
            document.getElementById('deleteAccountId').textContent = accountId;
            document.getElementById('deleteServer').textContent = server;
            document.getElementById('deleteIdentificationCode').textContent = identificationCode;
            document.getElementById('deleteModal').style.display = 'flex';
            document.getElementById('deleteAlert').style.display = 'none';
        }
        
        // ========== å…³é—­åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† ==========
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            clientToDelete = null;
        }
        
        // ========== ç¡®è®¤åˆ é™¤å®¢æˆ· ==========
        async function confirmDelete() {
            if (!clientToDelete) return;
            
            try {
                const response = await fetch(`${API_BASE}/delete/${clientToDelete}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('deleteAlert', 'âœ… å®¢æˆ·åˆ é™¤æˆåŠŸï¼', 'success');
                    setTimeout(() => {
                        closeDeleteModal();
                        loadClients();
                    }, 1000);
                } else {
                    showAlert('deleteAlert', `åˆ é™¤å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showAlert('deleteAlert', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // ========== æµ‹è¯•éªŒè¯æ¥å£ ==========
        async function testVerify() {
            const accountId = document.getElementById('testAccountId').value.trim();
            const server = document.getElementById('testServer').value.trim();
            const testResultDiv = document.getElementById('testResult');
            
            if (!accountId || !server) {
                showAlert('testAlert', 'è¯·è¾“å…¥è´¦å·å’ŒæœåŠ¡å™¨', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        account_id: accountId,
                        license_key: server
                    })
                });
                
                const result = await response.json();
                
                if (result.valid) {
                    testResultDiv.innerHTML = `
                        <div style="background: #d5f4e6; color: #27ae60; padding: 15px; border-radius: 6px; border: 1px solid #a3e4c1;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">âœ… éªŒè¯æˆåŠŸï¼</div>
                            <div style="font-size: 14px;">
                                <div>è´¦å·ID: <strong>${result.account_id}</strong></div>
                                <div>åˆ°æœŸæ—¶é—´: <strong>${result.expire_date}</strong></div>
                                <div>çŠ¶æ€: <span style="color: #27ae60; font-weight: 600;">æ­£å¸¸</span></div>
                            </div>
                        </div>
                    `;
                    testResultDiv.style.display = 'block';
                } else {
                    testResultDiv.innerHTML = `
                        <div style="background: #fadbd8; color: #e74c3c; padding: 15px; border-radius: 6px; border: 1px solid #f5b7b1;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">âŒ éªŒè¯å¤±è´¥</div>
                            <div style="font-size: 14px;">é”™è¯¯ä¿¡æ¯: ${result.message}</div>
                        </div>
                    `;
                    testResultDiv.style.display = 'block';
                }
                
            } catch (error) {
                testResultDiv.innerHTML = `
                    <div style="background: #fef5e7; color: #f39c12; padding: 15px; border-radius: 6px; border: 1px solid #f8c471;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">âš ï¸ ç½‘ç»œé”™è¯¯</div>
                        <div style="font-size: 14px;">${error.message}</div>
                    </div>
                `;
                testResultDiv.style.display = 'block';
            }
        }
        
        // ========== æ•°æ®å¯¼å‡ºåŠŸèƒ½ ==========
        async function exportData() {
            const searchQuery = currentSearchQuery || '';
            
            try {
                const url = `${API_BASE}/export/csv?search=${encodeURIComponent(searchQuery)}`;
                
                // åˆ›å»ºä¸´æ—¶é“¾æ¥è§¦å‘ä¸‹è½½
                const a = document.createElement('a');
                a.href = url;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showMainAlert('å¯¼å‡ºä»»åŠ¡å·²å¼€å§‹ï¼Œæ–‡ä»¶å°†è‡ªåŠ¨ä¸‹è½½', 'success');
                
            } catch (error) {
                console.error('å¯¼å‡ºé”™è¯¯:', error);
                showMainAlert(`å¯¼å‡ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function downloadTemplate(format = 'full') {
            try {
                let url;
                if (format === 'simple') {
                    url = `${API_BASE}/export/template`;
                } else {
                    url = `${API_BASE}/export/template/full`;
                }
                
                const a = document.createElement('a');
                a.href = url;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showMainAlert(`æ¨¡æ¿ä¸‹è½½å·²å¼€å§‹ (${format === 'simple' ? 'ç®€åŒ–' : 'å®Œæ•´'}æ ¼å¼)`, 'success');
                
            } catch (error) {
                console.error('ä¸‹è½½æ¨¡æ¿é”™è¯¯:', error);
                showMainAlert(`ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // ========== æ•°æ®å¯¼å…¥åŠŸèƒ½ ==========
        
        // é€‰æ‹©å¯¼å…¥é€‰é¡¹
        function selectImportOption(format) {
            importFormat = format;
            
            // æ›´æ–°é€‰é¡¹UI
            document.querySelectorAll('.import-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.import-option').classList.add('active');
            
            // æ›´æ–°æ ¼å¼ä¿¡æ¯
            const formatInfo = document.getElementById('formatInfo');
            if (format === 'simple') {
                formatInfo.textContent = '(æ”¯æŒç®€å•æ ¼å¼ï¼Œ6ä¸ªå­—æ®µ)';
            } else {
                formatInfo.textContent = '(æ”¯æŒå®Œæ•´æ ¼å¼ï¼Œ10ä¸ªå­—æ®µ)';
            }
            
            // é‡ç½®é¢„è§ˆ
            resetPreview();
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect() {
            const fileInput = document.getElementById('csvFile');
            const fileNameSpan = document.getElementById('fileName');
            
            if (fileInput.files && fileInput.files.length > 0) {
                selectedFile = fileInput.files[0];
                fileNameSpan.textContent = selectedFile.name;
                fileNameSpan.style.color = '#2c3e50';
                
                // å¯ç”¨é¢„è§ˆæŒ‰é’®
                document.getElementById('previewBtn').disabled = false;
            } else {
                selectedFile = null;
                fileNameSpan.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                fileNameSpan.style.color = '#7f8c8d';
                document.getElementById('previewBtn').disabled = true;
            }
            
            // ç¦ç”¨å¯¼å…¥æŒ‰é’®ï¼Œç›´åˆ°é¢„è§ˆå®Œæˆ
            document.getElementById('importBtn').disabled = true;
        }
        
        // é¢„è§ˆå¯¼å…¥æ•°æ®
        async function previewImport() {
            if (!selectedFile) {
                showMainAlert('è¯·å…ˆé€‰æ‹©CSVæ–‡ä»¶', 'warning');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            
            try {
                showMainAlert('æ­£åœ¨é¢„è§ˆæ•°æ®...', 'info');
                
                const response = await fetch(`${API_BASE}/import/preview`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    importPreviewData = result.preview_data || [];
                    renderPreview(importPreviewData, result.format, result.fields);
                    showMainAlert(`é¢„è§ˆæˆåŠŸï¼Œå…±${result.total_rows}è¡Œæ•°æ®ï¼Œå·²è¯»å–${importPreviewData.length}è¡Œ`, 'success');
                    
                    // å¯ç”¨å¯¼å…¥æŒ‰é’®
                    document.getElementById('importBtn').disabled = false;
                } else {
                    showMainAlert(`é¢„è§ˆå¤±è´¥: ${result.message}`, 'error');
                    resetPreview();
                }
                
            } catch (error) {
                console.error('é¢„è§ˆé”™è¯¯:', error);
                showMainAlert(`é¢„è§ˆå¤±è´¥: ${error.message}`, 'error');
                resetPreview();
            }
        }
        
        // æ¸²æŸ“é¢„è§ˆæ•°æ®
        function renderPreview(data, format, fields) {
            const previewContainer = document.getElementById('previewContainer');
            const previewHeader = document.getElementById('previewHeader');
            const previewBody = document.getElementById('previewBody');
            const previewStats = document.getElementById('previewStats');
            
            // æ˜¾ç¤ºé¢„è§ˆå®¹å™¨
            previewContainer.style.display = 'block';
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            const totalRows = data.length;
            const validRows = data.filter(row => row.is_valid).length;
            const invalidRows = totalRows - validRows;
            previewStats.textContent = `å…±${totalRows}æ¡ï¼Œæœ‰æ•ˆ:${validRows}ï¼Œæ— æ•ˆ:${invalidRows}`;
            
            // æ¸²æŸ“è¡¨å¤´
            let headerHtml = '';
            if (format === 'full') {
                headerHtml = `
                    <tr>
                        <th>è¡Œå·</th>
                        <th>è´¦å·ID</th>
                        <th>æœåŠ¡å™¨</th>
                        <th>è¯†åˆ«ç </th>
                        <th>åˆ°æœŸæ—¶é—´</th>
                        <th>çŠ¶æ€</th>
                        <th>æœ€å¤§ä¼šè¯æ•°</th>
                        <th>å½“å‰ä¼šè¯æ•°</th>
                        <th>å¤‡æ³¨</th>
                        <th>éªŒè¯çŠ¶æ€</th>
                    </tr>
                `;
            } else {
                headerHtml = `
                    <tr>
                        <th>è¡Œå·</th>
                        <th>è´¦å·ID</th>
                        <th>æœåŠ¡å™¨</th>
                        <th>è¯†åˆ«ç </th>
                        <th>åˆ°æœŸæ—¶é—´</th>
                        <th>çŠ¶æ€</th>
                        <th>å¤‡æ³¨</th>
                        <th>éªŒè¯çŠ¶æ€</th>
                    </tr>
                `;
            }
            previewHeader.innerHTML = headerHtml;
            
            // æ¸²æŸ“æ•°æ®è¡Œ
            let bodyHtml = '';
            data.forEach(item => {
                let rowHtml = `<tr>`;
                
                // è¡Œå·
                rowHtml += `<td>${item.row}</td>`;
                
                // è´¦å·ID
                rowHtml += `<td>${item.account_id || ''}</td>`;
                
                // æœåŠ¡å™¨
                rowHtml += `<td>${item.license_key || ''}</td>`;
                
                // è¯†åˆ«ç 
                let idCode = item.identification_code || '';
                if (idCode.length > 15) {
                    idCode = idCode.substring(0, 15) + '...';
                }
                rowHtml += `<td title="${item.identification_code || ''}">${idCode}</td>`;
                
                // åˆ°æœŸæ—¶é—´
                rowHtml += `<td>${item.expire_date || ''}</td>`;
                
                // çŠ¶æ€
                const statusText = item.is_active ? 'æ­£å¸¸' : 'ç¦ç”¨';
                rowHtml += `<td>${statusText}</td>`;
                
                // å¦‚æœæ˜¯å®Œæ•´æ ¼å¼ï¼Œæ·»åŠ é¢å¤–å­—æ®µ
                if (format === 'full') {
                    rowHtml += `<td>${item.max_sessions || 999}</td>`;
                    rowHtml += `<td>${item.current_sessions || 0}</td>`;
                }
                
                // å¤‡æ³¨
                let notes = item.notes || '';
                if (notes.length > 10) {
                    notes = notes.substring(0, 10) + '...';
                }
                rowHtml += `<td title="${item.notes || ''}">${notes}</td>`;
                
                // éªŒè¯çŠ¶æ€
                let statusHtml = '';
                if (item.is_valid) {
                    statusHtml = `<span class="preview-valid">âœ… æœ‰æ•ˆ</span>`;
                    if (item.exists_in_db) {
                        statusHtml += `<br><span class="preview-exists">âš ï¸ å·²å­˜åœ¨</span>`;
                    }
                } else {
                    statusHtml = `<span class="preview-invalid">âŒ æ— æ•ˆ</span>`;
                    if (item.validation_errors && item.validation_errors.length > 0) {
                        statusHtml += `<br><small>${item.validation_errors.join(', ')}</small>`;
                    }
                }
                rowHtml += `<td>${statusHtml}</td>`;
                
                rowHtml += `</tr>`;
                bodyHtml += rowHtml;
            });
            
            previewBody.innerHTML = bodyHtml;
        }
        
        // é‡ç½®é¢„è§ˆ
        function resetPreview() {
            const previewContainer = document.getElementById('previewContainer');
            const previewBody = document.getElementById('previewBody');
            const fileNameSpan = document.getElementById('fileName');
            
            previewContainer.style.display = 'none';
            previewBody.innerHTML = '';
            importPreviewData = [];
            
            // é‡ç½®æ–‡ä»¶è¾“å…¥
            document.getElementById('csvFile').value = '';
            selectedFile = null;
            fileNameSpan.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            fileNameSpan.style.color = '#7f8c8d';
            
            // ç¦ç”¨æŒ‰é’®
            document.getElementById('previewBtn').disabled = true;
            document.getElementById('importBtn').disabled = true;
        }
        
        // é‡ç½®å¯¼å…¥
        function resetImport() {
            resetPreview();
            showMainAlert('å¯¼å…¥è¡¨å•å·²é‡ç½®', 'info');
        }
        
        // æ‰§è¡Œå¯¼å…¥
        async function executeImport() {
            if (!selectedFile) {
                showMainAlert('è¯·å…ˆé€‰æ‹©CSVæ–‡ä»¶', 'warning');
                return;
            }
            
            if (importPreviewData.length === 0) {
                showMainAlert('è¯·å…ˆé¢„è§ˆæ•°æ®', 'warning');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ— æ•ˆæ•°æ®
            const invalidCount = importPreviewData.filter(item => !item.is_valid).length;
            if (invalidCount > 0) {
                if (!confirm(`å‘ç°${invalidCount}æ¡æ— æ•ˆæ•°æ®ï¼Œæ˜¯å¦ç»§ç»­å¯¼å…¥ï¼Ÿ`)) {
                    return;
                }
            }
            
            // æ‰“å¼€å¯¼å…¥è¿›åº¦æ¨¡æ€æ¡†
            openImportProgressModal();
            isImporting = true;
            importCanceled = false;
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            
            // æ·»åŠ å¯¼å…¥æ¨¡å¼
            const importMode = document.querySelector('input[name="importMode"]:checked').value;
            formData.append('update_mode', importMode === 'update' ? 'true' : 'false');
            
            try {
                // æ›´æ–°è¿›åº¦
                updateImportProgress(10, 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...');
                
                const response = await fetch(`${API_BASE}/import/csv`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (importCanceled) {
                    showMainAlert('å¯¼å…¥å·²å–æ¶ˆ', 'warning');
                    return;
                }
                
                if (result.success) {
                    updateImportProgress(100, 'å¯¼å…¥å®Œæˆï¼');
                    
                    // æ˜¾ç¤ºå¯¼å…¥ç»“æœ
                    showImportResult(result);
                    showMainAlert(`å¯¼å…¥å®Œæˆï¼æˆåŠŸ:${result.imported}ï¼Œè·³è¿‡:${result.skipped}ï¼Œå¤±è´¥:${result.failed}`, 'success');
                    
                    // åˆ·æ–°å®¢æˆ·åˆ—è¡¨
                    loadClients();
                } else {
                    updateImportProgress(0, `å¯¼å…¥å¤±è´¥: ${result.message}`);
                    showMainAlert(`å¯¼å…¥å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('å¯¼å…¥é”™è¯¯:', error);
                updateImportProgress(0, `å¯¼å…¥å¤±è´¥: ${error.message}`);
                showMainAlert(`å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
            } finally {
                isImporting = false;
            }
        }
        
        // æ‰“å¼€å¯¼å…¥è¿›åº¦æ¨¡æ€æ¡†
        function openImportProgressModal() {
            const modal = document.getElementById('importProgressModal');
            const progressBar = document.getElementById('importProgressBar');
            const progressPercent = document.getElementById('importProgressPercent');
            const progressText = document.getElementById('importProgressText');
            const resultDiv = document.getElementById('importResult');
            const closeBtn = document.getElementById('importCloseBtn');
            const cancelBtn = document.getElementById('importCancelBtn');
            
            // é‡ç½®æ˜¾ç¤º
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            progressText.textContent = 'æ­£åœ¨å¤„ç†...';
            resultDiv.style.display = 'none';
            closeBtn.style.display = 'none';
            cancelBtn.style.display = 'block';
            
            modal.style.display = 'flex';
        }
        
        // å…³é—­å¯¼å…¥è¿›åº¦æ¨¡æ€æ¡†
        function closeImportProgressModal() {
            document.getElementById('importProgressModal').style.display = 'none';
        }
        
        // å–æ¶ˆå¯¼å…¥
        function cancelImport() {
            if (isImporting) {
                importCanceled = true;
                showMainAlert('æ­£åœ¨å–æ¶ˆå¯¼å…¥...', 'warning');
            }
            closeImportProgressModal();
        }
        
        // æ›´æ–°å¯¼å…¥è¿›åº¦
        function updateImportProgress(percent, text) {
            const progressBar = document.getElementById('importProgressBar');
            const progressPercent = document.getElementById('importProgressPercent');
            const progressText = document.getElementById('importProgressText');
            const closeBtn = document.getElementById('importCloseBtn');
            const cancelBtn = document.getElementById('importCancelBtn');
            
            progressBar.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            progressText.textContent = text;
            
            if (percent >= 100) {
                cancelBtn.style.display = 'none';
                closeBtn.style.display = 'block';
            }
        }
        
        // æ˜¾ç¤ºå¯¼å…¥ç»“æœ
        function showImportResult(result) {
            const resultDiv = document.getElementById('importResult');
            const successCount = document.getElementById('importSuccessCount');
            const skipCount = document.getElementById('importSkipCount');
            const failCount = document.getElementById('importFailCount');
            const importDetails = document.getElementById('importDetails');
            
            successCount.textContent = result.imported || 0;
            skipCount.textContent = result.skipped || 0;
            failCount.textContent = result.failed || 0;
            
            // æ˜¾ç¤ºå¯¼å…¥è¯¦æƒ…
            let detailsHtml = '';
            if (result.results && result.results.length > 0) {
                result.results.forEach(item => {
                    let statusIcon = '';
                    let statusColor = '';
                    
                    if (item.status === 'å¯¼å…¥' || item.status === 'æ›´æ–°') {
                        statusIcon = 'âœ…';
                        statusColor = '#27ae60';
                    } else if (item.status === 'è·³è¿‡') {
                        statusIcon = 'ğŸ”„';
                        statusColor = '#f39c12';
                    } else {
                        statusIcon = 'âŒ';
                        statusColor = '#e74c3c';
                    }
                    
                    detailsHtml += `<div style="margin-bottom: 5px;">
                        <span style="color: ${statusColor}; font-weight: bold;">${statusIcon} è¡Œ${item.row}:</span>
                        <span>è´¦å· ${item.account_id || 'æœªçŸ¥'} - ${item.status} - ${item.message}</span>
                    </div>`;
                });
            } else {
                detailsHtml = '<div style="color: #7f8c8d; text-align: center;">æš‚æ— è¯¦ç»†ç»“æœ</div>';
            }
            
            importDetails.innerHTML = detailsHtml;
            resultDiv.style.display = 'block';
        }
        
        // ========== é”®ç›˜å¿«æ·é”® ==========
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeEditModal();
                closeDeleteModal();
                closeImportProgressModal();
            }
            
            if (event.key === 'Enter' && document.getElementById('loginContainer').style.display !== 'none') {
                login();
            }
            
            if (event.key === 'Enter' && event.target.id === 'searchInput') {
                searchClients();
            }
        });
        
        // æœç´¢æ¡†è¾“å…¥ç›‘å¬
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                if (this.value.trim().length >= 2 || this.value.trim().length === 0) {
                    searchClients();
                }
            }, 500);
        });
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç™»å½•ï¼ˆæµ‹è¯•ç”¨ï¼‰
        window.addEventListener('DOMContentLoaded', function() {
            // ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œè‡ªåŠ¨å¡«å……ç™»å½•ä¿¡æ¯
            document.getElementById('username').value = 'islandshen@163.com';
            document.getElementById('password').value = 'Auo_0523';
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 30);
            document.getElementById('addExpireDate').valueAsDate = defaultDate;
        });
    </script>
</body>
</html>